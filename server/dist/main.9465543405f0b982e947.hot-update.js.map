{"version":3,"sources":["webpack:///./src/api/modules/auth.js"],"names":["aaud","tokenUrl","tokenKeys","getJWT","resolve","reject","axios","get","keys","data","verifyToken","req","res","next","bearerLength","length","authorization","headers","token","slice","tokenData","jwt","decode","complete","header","kid","alg","payload","aud","exp","filter","k","matchKey","current_ts","Math","floor","Date","undefined","user","originalUrl","match","method","toLowerCase","status","send","success","error"],"mappings":"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","file":"main.9465543405f0b982e947.hot-update.js","sourcesContent":["import axios from 'axios';\nimport jwt from 'jsonwebtoken';\nconst aaud = process.env.COGNITO_AUD;\nconst tokenUrl = `https://cognito-idp.us-east-2.amazonaws.com/us-east-2_ZAwetvcgl/.well-known/jwks.json`;\n\nlet tokenKeys = null;\n\nexport const getJWT = () => new Promise(async (resolve, reject) => {\n    try {\n        const { data: { keys } } = await axios.get(tokenUrl);\n        tokenKeys  = keys;\n        resolve();\n    } catch (err) {\n        reject(err);\n    }\n});\n\nexport const verifyToken = (req, res, next) => {\n    const bearerLength = \"Bearer \".length;\n    const authorization = req.headers.authorization;\n\n    if (authorization && authorization.length > bearerLength) {\n        const token = authorization.slice(bearerLength);\n        const tokenData = jwt.decode(token, { complete: true });\n \n        if (!!tokenData) {\n            const { header: { kid, alg }, payload } = tokenData;\n            const { aud, exp } = payload;\n            const [ matchKey ] = tokenKeys.filter((k) => (k.kid === kid && k.alg === alg));\n            const current_ts = Math.floor(new Date() / 1000);\n\n            if (matchKey !== undefined && aaud === aud && current_ts < exp) {\n                req.user = payload;\n                next();\n                return;\n            }\n        }\n    }\n    \n    if (\n        req.originalUrl.match('/api/invoice') !== null && req.method.toLowerCase() === 'get' ||\n        req.originalUrl.match('/api/payment') !== null && req.method.toLowerCase() === 'post' ||\n        req.originalUrl.match('/api/payment') !== null && req.method.toLowerCase() === 'get' ||\n        req.originalUrl.match('/api/banks') !== null && req.method.toLowerCase() === 'get' ||\n        req.originalUrl.match('/api/dispute') !== null && req.method.toLowerCase() === 'post' ||\n        req.originalUrl.match('/api/dispute') !== null && req.method.toLowerCase() === 'get' ||\n        req.originalUrl.match('/api/verify') !== null && req.method.toLowerCase() === 'get'\n    ) {\n        next(); \n        return;\n    } \n\n    res.status(403).send({ success: false, error: 'Invalid auth token' });\n    return;\n};"],"sourceRoot":""}