{"version":3,"sources":["webpack:///./src/api/resources/invoice/invoice.controller.js"],"names":["generateController","createOne","req","res","body","userId","user","id","marchantEmail","email","status","verifyCode","recode","totalPrice","purchaseAmount","deliveryAmount","CreateInvoice","customerEmail","name","customerName","phone","customerPhone","description","request_code","data","invoice_code","InvoiceModel","create","err","doc","send","error","message","success"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;;AAEA,+DAAe,2EAAAA,CAAmB,sDAAnB,EAAiC;AAC5CC;AAAA,qLAAW,kBAAOC,GAAP,EAAYC,GAAZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AACHC,gCADG,GACIF,IAAIE,IADR;;AAEPA,iCAAKC,MAAL,GAAcH,IAAII,IAAJ,CAASC,EAAvB;AACAH,iCAAKI,aAAL,GAAqBN,IAAII,IAAJ,CAASG,KAA9B;AACAL,iCAAKM,MAAL,GAAc,MAAd;AACAN,iCAAKO,UAAL,GAAkB,SAAqC,SAArC,GAAkD,+DAAAC,EAApE;AACAR,iCAAKS,UAAL,GAAkB,MAAMT,KAAKU,cAAX,GAA4BV,KAAKW,cAAjC,GAAoDX,KAAKU,cAAL,GAAsB,CAAvB,GAA4B,GAAjG;;AANO;AAAA;AAAA,mCASuC,sEAAAE,CAAc,EAAEP,OAAOL,KAAKa,aAAd,EAA6BC,MAAMd,KAAKe,YAAxC,EAAsDC,OAAOhB,KAAKiB,aAAlE,EAAd,EAAiGjB,KAAKS,UAAtG,EAAkHT,KAAKkB,WAAvH,CATvC;;AAAA;AAAA;AASaC,wCATb,SASKC,IATL,CASaD,YATb;;;AAWHnB,iCAAKqB,YAAL,GAAoBF,YAApB;;AAEAG,4BAAA,sDAAAA,CAAaC,MAAb,CAAoBvB,IAApB;AAAA,8MAA0B,iBAAOwB,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA,yDAClBD,GADkB;AAAA;AAAA;AAAA;;AAAA,qFACNzB,IAAIO,MAAJ,CAAW,GAAX,EAAgBoB,IAAhB,CAAqB,EAAEC,OAAO,EAAEC,SAAS,8BAAX,EAAT,EAAsDC,SAAS,KAA/D,EAArB,CADM;;AAAA;AAEtB,2DAAOJ,IAAIlB,UAAX;AACAR,wDAAI2B,IAAJ,CAAS,EAAEN,MAAMK,GAAR,EAAaI,SAAS,IAAtB,EAAT;;AAHsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAA1B;;AAAA;AAAA;AAAA;AAAA;AAbG;AAAA;;AAAA;AAAA;AAAA;AAAA,8DAmBI9B,IAAIO,MAAJ,CAAW,GAAX,EAAgBoB,IAAhB,CAAqB,EAAEF,iBAAF,EAAOK,SAAS,KAAhB,EAArB,CAnBJ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAX;;AAAA;AAAA;AAAA;AAAA;AAD4C,CAAjC,CAAf,E","file":"main.957fb6fec9c85239ced5.hot-update.js","sourcesContent":["import InvoiceModel from './invoice.model';\nimport * as mailer from '../../modules/mailer';\nimport recode from '../../modules/recode';\nimport generateController from '../../modules/generateController';\nimport { CreateInvoice } from '../../modules/invoice';\n\nexport default generateController(InvoiceModel, {\n    createOne: async (req, res) => {\n        var body = req.body;\n        body.userId = req.user.id;\n        body.marchantEmail = req.user.email;\n        body.status = \"sent\";\n        body.verifyCode = process.env.NODE_ENV === 'testing' ? 'AXYZ0000' : recode();\n        body.totalPrice = 200 + body.purchaseAmount + body.deliveryAmount + ((body.purchaseAmount * 5) / 100);\n\n        try {\n            const { data: { request_code } }  = await CreateInvoice({ email: body.customerEmail, name: body.customerName, phone: body.customerPhone }, body.totalPrice, body.description);\n            \n            body.invoice_code = request_code;\n\n            InvoiceModel.create(body, async (err, doc) => {\n                if (err) return res.status(400).send({ error: { message: 'Could not create the invoice' }, success: false });\n                delete doc.verifyCode;\n                res.send({ data: doc, success: true });\n            });\n        } catch(err) {\n            return res.status(400).send({ err, success: false });\n        }\n    }\n});"],"sourceRoot":""}