{"version":3,"sources":["webpack:///./src/api/resources/dispute/dispute.controller.js"],"names":["DisputeController","generateController","getInvoiceId","req","res","next","_id","params","invoiceId","InvoiceModel","findOne","err","doc","status","send","error","message","success","invoice","createOne","body","marchantEmail","customerEmail","customerName","DisputeModel","create","sendDisputeMail","reason","from","data","getOne"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;AAEA,IAAMA,oBAAoB,2EAAAC,CAAmB,sDAAnB,EAAiC;AACvDC,kBAAc,sBAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC9B,YAAMC,MAAMH,IAAII,MAAJ,CAAWC,SAAvB;;AAEAC,QAAA,8DAAAA,CAAaC,OAAb,CAAqB,EAAEJ,QAAF,EAArB,EAA8B,UAACK,GAAD,EAAMC,GAAN,EAAc;AACxC,gBAAID,GAAJ,EAAS,OAAOP,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,EAAEC,SAAS,gCAAX,EAAT,EAAwDC,SAAS,KAAjE,EAArB,CAAP;AACTd,gBAAIe,OAAJ,GAAcN,GAAd;AACAP;AACH,SAJD;AAKH,KATsD;AAUvDc,eAAW,mBAAChB,GAAD,EAAMC,GAAN,EAAc;AACrB,YAAMgB,OAAOjB,IAAIiB,IAAjB;AADqB,2BAEuCjB,IAAIe,OAF3C;AAAA,YAEbG,aAFa,gBAEbA,aAFa;AAAA,YAEEC,aAFF,gBAEEA,aAFF;AAAA,YAEiBC,YAFjB,gBAEiBA,YAFjB;AAAA,YAE+BjB,GAF/B,gBAE+BA,GAF/B;;AAGrBc,aAAKP,MAAL,GAAc,MAAd;AACAO,aAAKZ,SAAL,GAAiBF,GAAjB;AACAkB,QAAA,sDAAAA,CAAaC,MAAb,CAAoBL,IAApB;AAAA,yLAA0B,iBAAOT,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA,qCAClBD,GADkB;AAAA;AAAA;AAAA;;AAAA,iEACNP,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,EAAEC,SAAS,8BAAX,EAAT,EAAsDC,SAAS,KAA/D,EAArB,CADM;;AAAA;AAAA;AAAA;AAAA,uCAIZ,uEAAAS,CAAgBL,aAAhB,EAA+BC,aAA/B,EAA8CC,YAA9C,EAA4DH,KAAKO,MAAjE,EAAyEP,KAAKQ,IAA9E,CAJY;;AAAA;AAKlBxB,oCAAIU,IAAJ,CAAS,EAAEe,MAAMjB,GAAR,EAAaK,SAAS,IAAtB,EAAT;AALkB;AAAA;;AAAA;AAAA;AAAA;AAAA,iEAOXb,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,EAAEC,SAAS,qBAAX,EAAT,EAA6CC,SAAS,KAAtD,EAArB,CAPW;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAA1B;;AAAA;AAAA;AAAA;AAAA;AAUH,KAzBsD;AA0BvDa,YAAQ,gBAAC3B,GAAD,EAAMC,GAAN,EAAc;AAClB,YAAMI,YAAYL,IAAII,MAAJ,CAAWC,SAA7B;AACAgB,QAAA,sDAAAA,CAAad,OAAb,CAAqB,EAAEF,oBAAF,EAArB;AAAA,0LAAoC,kBAAOG,GAAP,EAAYC,GAAZ;AAAA;AAAA;AAAA;AAAA;AAAA,qCAC5BD,GAD4B;AAAA;AAAA;AAAA;;AAAA,kEAChBP,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,EAAEC,SAAS,cAAX,EAAT,EAAsCC,SAAS,KAA/C,EAArB,CADgB;;AAAA;AAEhCb,oCAAIU,IAAJ,CAAS,EAAEe,MAAMjB,GAAR,EAAaK,SAAS,IAAtB,EAAT;;AAFgC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAApC;;AAAA;AAAA;AAAA;AAAA;AAIH;AAhCsD,CAAjC,CAA1B;;AAmCA,+DAAejB,iBAAf,E","file":"main.0997903fb3fabf7eca01.hot-update.js","sourcesContent":["import DisputeModel from './dispute.model';\nimport InvoiceModel from '../invoice/invoice.model';\nimport generateController from '../../modules/generateController';\nimport { sendDisputeMail } from '../../modules/mailer';\n\nconst DisputeController = generateController(DisputeModel, {\n    getInvoiceId: (req, res, next) => {\n        const _id = req.params.invoiceId;\n\n        InvoiceModel.findOne({ _id }, (err, doc) => {\n            if (err) return res.status(400).send({ error: { message: 'Invoice with id does not exits' }, success: false });\n            req.invoice = doc;\n            next()\n        });\n    },\n    createOne: (req, res) => {\n        const body = req.body;\n        const { marchantEmail, customerEmail, customerName, _id } = req.invoice;\n        body.status = \"open\";\n        body.invoiceId = _id;\n        DisputeModel.create(body, async (err, doc) => {\n            if (err) return res.status(400).send({ error: { message: 'Could not create the dispute' }, success: false });\n\n            try {\n                await sendDisputeMail(marchantEmail, customerEmail, customerName, body.reason, body.from);\n                res.send({ data: doc, success: true });\n            } catch (err) {\n                return res.status(400).send({ error: { message: 'Could not send mail' }, success: false });\n            }\n        });\n    },\n    getOne: (req, res) => {\n        const invoiceId = req.params.invoiceId;\n        DisputeModel.findOne({ invoiceId }, async (err, doc) => {\n            if (err) return res.status(400).send({ error: { message: 'Find dispute' }, success: false });\n            res.send({ data: doc, success: true });\n        });\n    }\n});\n\nexport default DisputeController;"],"sourceRoot":""}